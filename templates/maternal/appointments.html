{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">ğŸ“… {% trans "Appointments" %}</h1>
        <a href="{% url 'maternal_health:add_appointment' %}" class="px-5 py-2.5 bg-pink-600 text-white rounded-lg hover:bg-pink-700 shadow-lg">
            + {% trans "Schedule New" %}
        </a>
    </div>

    <h2 class="text-xl font-bold text-gray-700 mb-4 border-l-4 border-green-500 pl-3">{% trans "Upcoming" %}</h2>
    <div class="grid gap-4 mb-10">
        {% for appt in upcoming_appointments %}
        <div class="bg-white p-5 rounded-xl shadow-sm border-l-4 border-green-500 flex justify-between items-center">
            <div>
                <h3 class="font-bold text-lg text-gray-900">{{ appt.title }}</h3>
                <p class="text-gray-600 flex items-center gap-2 mt-1">
                    ğŸ—“ï¸ {{ appt.appointment_date }} 
                    â° {{ appt.appointment_time|default:"--:--" }}
                </p>
                {% if appt.doctor_name %}
                <p class="text-sm text-gray-500 mt-1">ğŸ‘¨â€âš•ï¸ {{ appt.doctor_name }} â€¢ {{ appt.hospital_name }}</p>
                {% endif %}
            </div>
            <form method="post" action="{% url 'maternal_health:mark_appointment_complete' appt.id %}">
                {% csrf_token %}
                <button type="button" onclick="markComplete({{ appt.id }})" class="px-4 py-2 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 text-sm font-medium">
                    {% trans "Mark Done" %}
                </button>
            </form>
        </div>
        {% empty %}
        <p class="text-gray-500 italic">{% trans "No upcoming appointments." %}</p>
        {% endfor %}
    </div>

    <h2 class="text-xl font-bold text-gray-700 mb-4 border-l-4 border-gray-400 pl-3">{% trans "Past History" %}</h2>
    <div class="grid gap-4 opacity-75">
        {% for appt in past_appointments %}
        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
            <h3 class="font-bold text-gray-700">{{ appt.title }}</h3>
            <p class="text-sm text-gray-500">{{ appt.appointment_date }}</p>
        </div>
        {% empty %}
        <p class="text-gray-500 italic">{% trans "No past appointments." %}</p>
        {% endfor %}
    </div>
</div>

<script>
function markComplete(id) {
    if(confirm('Mark this appointment as completed?')) {
        fetch(`/maternal-health/appointments/${id}/complete/`, {
            method: 'POST',
            headers: {'X-CSRFToken': '{{ csrf_token }}'}
        }).then(r => r.json()).then(data => {
            if(data.success) location.reload();
        });
    }
}
</script>
{% endblock %}